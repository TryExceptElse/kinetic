group 'com.github.io.tryexceptelse'
version '0.0.1'


buildscript {
    ext.build_dir = 'build'
    ext.server_dir = '../out/production/server'
}

task serverSetupPyBuild(type:Exec) {
    workingDir '.'
    commandLine 'python3', 'setup.py'
    args  'build', "-b${build_dir}"
}

task build() {
    dependsOn serverSetupPyBuild

    doLast {
        def fromDir = ''
        file('build').eachDir({
            if (it.name.startsWith("lib.")) {
                fromDir = "build/${it.name}"
                println "found server lib dir: ${fromDir}"
            }
        })
        copy {
            includeEmptyDirs = false
            from new File(fromDir)
            into "${server_dir}"
        }
    }
}

task clean() {
    doLast {
        delete(build_dir)
        delete(server_dir)
    }
}
